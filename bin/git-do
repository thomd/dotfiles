#!/usr/bin/env bash
set -e

#
# create a dummy commit for educational training
#
# thomduerr@gmail.com
#

usage() {
  echo "Create a dummy commit."
  echo "This is helpful for testing git commands which requires some test commits."
  echo ""
  echo "If the last commit message starts with an uppercase letter, then the subsequent"
  echo "commit messaged will use an uppercase letter sequence (only from A-Z)."
  echo "You may init a git repository with 'git setup -m A'"
  echo ""
  echo "Default filename is 'test.txt'"
  echo ""
  echo ""
  echo "Usage: git do [ filename ]"
  echo ""
  echo "  -h : print this screen"
  echo ""
}

while getopts h option
do
  case "${option}"
  in
    h) usage
      exit 1;;
  esac
done

FILE=${1:-test.txt}
LAST_MSG=$(git log --oneline --all --no-merges --pretty='%s' -1)

if [[ $LAST_MSG =~ ^[A-Z]$ ]]; then
  MSG=$(printf "%d" "'$LAST_MSG" | echo $(($(< /dev/stdin)+1)) | awk '{printf("%c",$1)}')
  echo $MSG >> $FILE
else
  COUNTER=$(echo $LAST_MSG | tr '-' ' ' | awk '{print $3}')
  COUNTER=$((${COUNTER}+1))
  MSG="added $FILE-$COUNTER in $FILE"
  echo $FILE-$COUNTER >> $FILE
fi
echo $MSG
git add .
git ci -m "$MSG"
