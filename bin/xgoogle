#!/usr/bin/env ruby
#
# print URLs of google search results to stdout
# the name 'xgoogle' is a homage to Peteris Krumins' xgoogle
#
# USAGE
#
#    xgoogle <searchquery> [<number-of-results> [<language>]]
#
#
# USECASES
#
#    download top 10 javascript pdf files:
#       xgoogle "javascript filetype:pdf" 10 | xargs wget -qc
#
#    find and open in browser
#       xgoogle "javascript" | urlview
#

require 'open-uri'
require 'nokogiri'

q   = ARGV[0].gsub(/ /, '%20')
num = ARGV[1] || '10'
hl  = ARGV[2] || 'en'

url = "http://www.google.com/search?num=#{num}&hl=#{hl}&q=#{q}"

puts "Searching #{url}:"
puts ""

serp = Nokogiri::HTML(open(url))

serp.css(".g h3 a").each do |ser|
  url = ser['href'].match(/url\?q=(.*)&sa=/)
  puts url[1] unless url.nil?
end

# vim:ft=ruby
