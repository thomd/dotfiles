#!/usr/bin/env bash

ORANGE="\e[38;5;222m"
GREEN="\e[0;32m"
GREY="\e[0;30m"
NONE="\e[0m"

usage() {
  echo -e "\n ${GREY}usage:${NONE}\n"
  echo -e "   git user [${ORANGE}thomd${NONE}|${GREEN}thduerr${NONE}]"
}

current_user() {
  if [ $(git config --get user.email) == "thomduerr@gmail.com" ]; then
    echo "${ORANGE}thomd${NONE}"
  else
    echo "${GREEN}thduerr${NONE}"
  fi
}

user() {
  local user=$(current_user)
  echo -e "\n ${GREY}current user:${NONE}\n"
  [ -n "$user" ] && echo -e "   ${user}"
  echo "   $(git config --get user.name)"
  echo "   $(git config --get user.email)"
}

identity() {
  echo -e "\n ${GREY}current identity:${NONE}\n"
  if [ $(ssh-add -l | awk '{gsub(/.*\//, "", $3); print $3}') == "github_thomd" ]; then
    ssh-add -E md5 -l 2>&1 | sed 's/^/   /' | perl -pe "s/(.*MD5:)(.*?) (.*)/\1${ORANGE}\2\e[0m \3/g"
  else
    ssh-add -E md5 -l 2>&1 | sed 's/^/   /' | perl -pe "s/(.*MD5:)(.*?) (.*)/\1${GREEN}\2\e[0m \3/g"
  fi
}

[ -z "$1" ] && usage && identity && user && exit 1

if [ "$1" == "thomd" ]; then
  git config user.name "Thomas DÃ¼rr" 2> /dev/null
  git config user.email "thomduerr@gmail.com" 2> /dev/null
  ssh-add -D 2> /dev/null
  ssh-add -K ~/.ssh/github_thomd 2> /dev/null
  identity
  user
fi

# use git user defined in global git config
if [ "$1" == "thduerr" ]; then
  git config --unset user.name 2> /dev/null
  git config --unset user.email 2> /dev/null
  ssh-add -D 2> /dev/null
  ssh-add -K ~/.ssh/github_thduerr 2> /dev/null
  identity
  user
fi

